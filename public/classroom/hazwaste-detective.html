<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Âç±Â∫üÈâ¥Âà´ÂâßÊú¨ÊùÄ - ÁéØÂ¢É‰æ¶Êé¢</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --detective-dark: #1a1a2e;
            --detective-darker: #16213e;
            --detective-accent: #e94560;
            --detective-gold: #f4a261;
            --detective-green: #2a9d8f;
            --detective-blue: #457b9d;
            --clue-bg: #f8f4e8;
            --clue-border: #c9b896;
            --text-light: #e8e8e8;
            --text-muted: #94a3b8;
        }
        
        body { 
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif; 
            background: linear-gradient(135deg, var(--detective-dark) 0%, var(--detective-darker) 100%);
            color: var(--text-light); 
            min-height: 100vh;
        }
        
        /* ==================== È°∂ÈÉ®Áä∂ÊÄÅÊ†è ==================== */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 24px;
            background: rgba(0,0,0,0.4);
            border-bottom: 2px solid var(--detective-accent);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .game-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .game-title h1 {
            font-size: 1.4rem;
            font-weight: 600;
            background: linear-gradient(90deg, var(--detective-gold), var(--detective-accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .case-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            background: rgba(233, 69, 96, 0.2);
            color: var(--detective-accent);
            border: 1px solid var(--detective-accent);
        }
        
        .status-group {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .budget-display {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(244, 162, 97, 0.15);
            border: 1px solid var(--detective-gold);
            border-radius: 12px;
        }
        
        .budget-icon { font-size: 1.2rem; }
        .budget-amount {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--detective-gold);
        }
        .budget-label { font-size: 0.75rem; color: var(--text-muted); }
        
        .timer-display {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(69, 123, 157, 0.2);
            border: 1px solid var(--detective-blue);
            border-radius: 12px;
        }
        
        .timer-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--detective-blue);
            font-family: 'Courier New', monospace;
        }
        
        .help-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--text-muted);
            background: transparent;
            color: var(--text-muted);
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .help-btn:hover {
            border-color: var(--detective-gold);
            color: var(--detective-gold);
        }
        
        /* ==================== ‰∏ªÂ∏ÉÂ±Ä ==================== */
        .main-layout {
            display: grid;
            grid-template-columns: 340px 1fr 80px;
            gap: 20px;
            padding: 20px;
            height: calc(100vh - 70px);
        }
        
        /* ==================== Ê°à‰ª∂Âç∑ÂÆóÈù¢Êùø ==================== */
        .case-panel {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .panel-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            font-weight: 600;
            font-size: 1rem;
        }
        
        .panel-icon { font-size: 1.2rem; }
        
        .case-file {
            flex: 1;
            position: relative;
        }
        
        .file-folder {
            background: var(--clue-bg);
            border-radius: 0 15px 15px 15px;
            height: 100%;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        
        .folder-tab {
            position: absolute;
            top: -28px;
            left: 0;
            background: var(--clue-bg);
            padding: 6px 20px;
            border-radius: 10px 10px 0 0;
            color: #5a4a3a;
            font-weight: bold;
            font-size: 0.85rem;
            border-bottom: none;
        }
        
        .folder-content {
            padding: 20px;
            color: #3a3a3a;
            height: 100%;
            overflow-y: auto;
        }
        
        /* Ê°à‰ª∂Â§¥ÈÉ®Ê†∑Âºè - Requirements: 1.2 */
        .case-header {
            margin-bottom: 18px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--clue-border);
            text-align: center;
        }
        
        .case-name {
            font-size: 1.1rem;
            font-weight: bold;
            color: #3a3a3a;
            margin-bottom: 6px;
        }
        
        .case-description {
            font-size: 0.85rem;
            color: #666;
            line-height: 1.5;
        }
        
        .case-section {
            margin-bottom: 18px;
            padding-bottom: 15px;
            border-bottom: 1px dashed var(--clue-border);
        }
        
        .case-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .section-title {
            font-weight: bold;
            color: #5a4a3a;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .section-content {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #4a4a4a;
        }
        
        .photo-gallery {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .photo-thumb {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid var(--clue-border);
            transition: transform 0.2s;
        }
        
        .photo-thumb:hover {
            transform: scale(1.1);
        }
        
        /* ÁÖßÁâáËÆ°Êï∞Ê†∑Âºè - Requirements: 1.4 */
        .photo-count {
            font-size: 0.75rem;
            font-weight: normal;
            color: #888;
            margin-left: 5px;
        }
        
        /* ÂõæÁâáÊü•ÁúãÂô®Â¢ûÂº∫Ê†∑Âºè - Requirements: 1.4 */
        .photo-viewer-container {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            max-width: 90%;
            max-height: 90%;
        }
        
        #photo-viewer {
            max-width: 100%;
            max-height: 85vh;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        
        .photo-nav-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
            z-index: 10;
        }
        
        .photo-nav-btn:hover {
            background: rgba(255,255,255,0.4);
        }
        
        .photo-prev {
            left: -70px;
        }
        
        .photo-next {
            right: -70px;
        }
        
        .photo-indicator {
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
        }
        
        .photo-indicator-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255,255,255,0.4);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .photo-indicator-dot.active {
            background: var(--detective-gold);
            transform: scale(1.2);
        }
        
        .photo-close-btn {
            position: absolute;
            top: -50px;
            right: -10px;
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .photo-close-btn:hover {
            background: var(--detective-accent);
        }
        
        .difficulty-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 12px;
            background: rgba(244, 162, 97, 0.9);
            border-radius: 15px;
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        /* È¢ÑÁÆóÂæΩÁ´†Ê†∑Âºè - Requirements: 1.5 */
        .budget-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 12px;
            background: rgba(42, 157, 143, 0.9);
            border-radius: 15px;
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .budget-badge-icon {
            font-size: 0.9rem;
        }
        
        .budget-badge-text {
            font-family: 'Courier New', monospace;
        }
        
        /* ==================== Á∫øÁ¥¢Êî∂ÈõÜÈù¢Êùø ==================== */
        .clues-panel {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .clue-count {
            margin-left: auto;
            background: var(--detective-accent);
            color: white;
            padding: 2px 10px;
            border-radius: 10px;
            font-size: 0.85rem;
        }
        
        .clues-container {
            flex: 1;
            background: rgba(255,255,255,0.03);
            border: 2px dashed rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-content: flex-start;
        }
        
        .empty-clues {
            width: 100%;
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }
        
        .empty-icon { font-size: 4rem; margin-bottom: 15px; opacity: 0.5; }
        .empty-text { font-size: 1.1rem; margin-bottom: 8px; }
        .empty-hint { font-size: 0.85rem; opacity: 0.7; }
        
        /* Á∫øÁ¥¢Âç°Áâá - Requirements: 2.5 */
        .clue-card {
            width: calc(50% - 6px);
            background: linear-gradient(145deg, var(--clue-bg) 0%, #f0ebe0 100%);
            border-radius: 12px;
            padding: 15px;
            color: #3a3a3a;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.8);
            position: relative;
            transition: all 0.3s ease;
            border: 2px solid var(--clue-border);
            overflow: hidden;
        }
        
        .clue-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--detective-blue);
        }
        
        .clue-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.25), inset 0 1px 0 rgba(255,255,255,0.8);
        }
        
        .clue-card.exceeded {
            border: 3px solid var(--detective-accent);
            animation: pulse-warning 2s infinite;
        }
        
        .clue-card.exceeded::before {
            background: var(--detective-accent);
        }
        
        @keyframes pulse-warning {
            0%, 100% { box-shadow: 0 4px 15px rgba(233, 69, 96, 0.3); }
            50% { box-shadow: 0 4px 25px rgba(233, 69, 96, 0.5); }
        }
        
        .clue-badge {
            position: absolute;
            top: -2px;
            right: 10px;
            background: var(--detective-accent);
            color: white;
            padding: 4px 12px;
            border-radius: 0 0 10px 10px;
            font-size: 0.75rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .clue-badge.normal {
            background: var(--detective-green);
        }
        
        .clue-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
            padding-top: 8px;
        }
        
        .clue-name {
            font-weight: bold;
            font-size: 0.95rem;
            color: #3a3a3a;
            max-width: 70%;
        }
        
        .clue-category {
            font-size: 0.7rem;
            padding: 3px 10px;
            background: rgba(69, 123, 157, 0.15);
            color: var(--detective-blue);
            border-radius: 10px;
            font-weight: 500;
        }
        
        .clue-body {
            display: flex;
            align-items: baseline;
            gap: 8px;
            margin: 10px 0;
        }
        
        .clue-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--detective-dark);
        }
        
        .clue-value.exceeded {
            color: var(--detective-accent);
        }
        
        .clue-unit {
            font-size: 0.9rem;
            color: #666;
        }
        
        .clue-comparison {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 10px;
            background: rgba(0,0,0,0.05);
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .clue-limit-label {
            font-size: 0.75rem;
            color: #888;
        }
        
        .clue-limit-value {
            font-size: 0.9rem;
            font-weight: bold;
            color: #555;
        }
        
        .clue-status {
            margin-left: auto;
            font-size: 0.8rem;
            font-weight: bold;
            padding: 3px 8px;
            border-radius: 5px;
        }
        
        .clue-status.exceeded {
            background: rgba(233, 69, 96, 0.15);
            color: var(--detective-accent);
        }
        
        .clue-status.normal {
            background: rgba(42, 157, 143, 0.15);
            color: var(--detective-green);
        }
        
        .clue-order {
            position: absolute;
            bottom: 8px;
            right: 10px;
            font-size: 0.7rem;
            color: #aaa;
        }
        
        /* Á∫øÁ¥¢Âç°ÁâáÈ´ò‰∫ÆÂä®Áîª */
        @keyframes highlight-pulse {
            0% { 
                transform: scale(1);
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            }
            50% { 
                transform: scale(1.02);
                box-shadow: 0 8px 30px rgba(244, 162, 97, 0.5);
            }
            100% { 
                transform: scale(1);
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            }
        }
        
        /* Êñ∞Â¢ûÁ∫øÁ¥¢Âç°ÁâáÂÖ•Âú∫Âä®Áîª */
        @keyframes clue-card-enter {
            0% {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .clue-card {
            animation: clue-card-enter 0.3s ease-out;
        }
        
        /* ==================== Âà§ÂÆöÂå∫Âüü ==================== */
        .judgment-area {
            padding-top: 15px;
        }
        
        .judgment-btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 15px;
            background: linear-gradient(135deg, var(--detective-accent) 0%, #c73e54 100%);
            color: white;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(233, 69, 96, 0.4);
        }
        
        .judgment-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(233, 69, 96, 0.5);
        }
        
        .btn-icon { font-size: 1.3rem; }
        
        /* ==================== Âè≥‰æßÂ∑•ÂÖ∑Ê†è ==================== */
        .tools-panel {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .tool-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            padding: 12px 8px;
            border: 2px solid rgba(255,255,255,0.15);
            border-radius: 12px;
            background: rgba(255,255,255,0.05);
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .tool-btn:hover {
            background: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.3);
            color: white;
        }
        
        .tool-btn.primary {
            background: linear-gradient(135deg, var(--detective-green) 0%, #238b7e 100%);
            border-color: var(--detective-green);
            color: white;
        }
        
        .tool-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(42, 157, 143, 0.4);
        }
        
        .tool-btn.back {
            margin-top: auto;
            border-color: rgba(239, 68, 68, 0.3);
            color: #f87171;
        }
        
        .tool-btn.back:hover {
            background: rgba(239, 68, 68, 0.1);
        }
        
        .tool-icon { font-size: 1.4rem; }
        .tool-label { font-size: 0.7rem; text-align: center; }
        
        .tool-cost {
            position: absolute;
            top: -8px;
            right: -5px;
            background: var(--detective-gold);
            color: white;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 0.65rem;
            font-weight: bold;
        }
        
        .tool-divider {
            height: 1px;
            background: rgba(255,255,255,0.1);
            margin: 5px 0;
        }
        
        /* ==================== Ê®°ÊÄÅÊ°ÜÈÄöÁî®Ê†∑Âºè ==================== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--detective-darker);
            border-radius: 20px;
            max-width: 90%;
            max-height: 90%;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            border: 2px solid rgba(255,255,255,0.1);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .modal-title {
            font-size: 1.3rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: rgba(255,255,255,0.1);
            color: var(--text-muted);
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .modal-close:hover {
            background: var(--detective-accent);
            color: white;
        }
        
        .modal-body {
            padding: 25px;
            overflow-y: auto;
            max-height: calc(90vh - 150px);
        }
        
        /* ==================== ÂìçÂ∫îÂºèÈÄÇÈÖç ==================== */
        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 300px 1fr 70px;
            }
            
            .clue-card {
                width: 100%;
            }
        }
        
        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 280px 1fr 65px;
                gap: 15px;
                padding: 15px;
            }
            
            .top-bar {
                padding: 10px 15px;
            }
            
            .game-title h1 {
                font-size: 1.2rem;
            }
            
            .budget-amount {
                font-size: 1.1rem;
            }
        }
        
        @media (max-width: 900px) {
            .main-layout {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto;
                height: auto;
                min-height: calc(100vh - 70px);
            }
            
            .case-panel {
                max-height: 280px;
            }
            
            .tools-panel {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
                gap: 8px;
            }
            
            .tool-btn {
                flex-direction: row;
                padding: 10px 15px;
            }
            
            .tool-divider {
                display: none;
            }
            
            .clue-card {
                width: 100%;
            }
            
            .clues-container {
                min-height: 200px;
            }
        }
        
        @media (max-width: 768px) {
            body {
                overflow-y: auto;
            }
            
            .top-bar {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
                padding: 10px;
            }
            
            .game-title {
                justify-content: center;
            }
            
            .game-title h1 {
                font-size: 1.1rem;
            }
            
            .status-group {
                justify-content: center;
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .budget-display, .timer-display {
                padding: 6px 12px;
            }
            
            .budget-amount {
                font-size: 1rem;
            }
            
            .main-layout {
                padding: 10px;
                gap: 10px;
            }
            
            .case-panel {
                max-height: 250px;
            }
            
            .folder-content {
                padding: 15px;
            }
            
            .case-section {
                margin-bottom: 12px;
                padding-bottom: 10px;
            }
            
            .section-title {
                font-size: 0.85rem;
            }
            
            .section-content {
                font-size: 0.9rem;
            }
            
            .clue-card {
                padding: 12px;
            }
            
            .clue-name {
                font-size: 0.9rem;
            }
            
            .clue-value {
                font-size: 1.5rem;
            }
            
            .judgment-btn {
                padding: 15px;
                font-size: 1rem;
            }
            
            .modal-content {
                max-width: 95%;
                border-radius: 15px;
            }
            
            .modal-header {
                padding: 15px 20px;
            }
            
            .modal-title {
                font-size: 1.1rem;
            }
            
            .modal-body {
                padding: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .top-bar {
                padding: 8px;
            }
            
            .game-title h1 {
                font-size: 1rem;
            }
            
            .case-badge {
                padding: 4px 10px;
                font-size: 0.75rem;
            }
            
            .budget-display, .timer-display {
                padding: 5px 10px;
            }
            
            .budget-amount {
                font-size: 0.95rem;
            }
            
            .budget-label {
                font-size: 0.65rem;
            }
            
            .timer-value {
                font-size: 1rem;
            }
            
            .help-btn {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
            
            .main-layout {
                padding: 8px;
                gap: 8px;
            }
            
            .panel-header {
                padding: 8px 12px;
                font-size: 0.9rem;
            }
            
            .case-panel {
                max-height: 220px;
            }
            
            .folder-content {
                padding: 12px;
            }
            
            .case-name {
                font-size: 1rem;
            }
            
            .case-description {
                font-size: 0.8rem;
            }
            
            .section-title {
                font-size: 0.8rem;
            }
            
            .section-content {
                font-size: 0.85rem;
                line-height: 1.5;
            }
            
            .photo-thumb {
                width: 60px;
                height: 60px;
            }
            
            .clues-container {
                padding: 10px;
            }
            
            .clue-card {
                padding: 10px;
            }
            
            .clue-name {
                font-size: 0.85rem;
            }
            
            .clue-value {
                font-size: 1.3rem;
            }
            
            .clue-unit {
                font-size: 0.8rem;
            }
            
            .clue-comparison {
                padding: 6px 8px;
            }
            
            .clue-limit-label {
                font-size: 0.7rem;
            }
            
            .clue-limit-value {
                font-size: 0.8rem;
            }
            
            .tool-btn {
                padding: 8px 12px;
            }
            
            .tool-icon {
                font-size: 1.2rem;
            }
            
            .tool-label {
                font-size: 0.65rem;
            }
            
            .judgment-btn {
                padding: 12px;
                font-size: 0.95rem;
            }
            
            .btn-icon {
                font-size: 1.1rem;
            }
            
            .empty-icon {
                font-size: 3rem;
            }
            
            .empty-text {
                font-size: 1rem;
            }
            
            .empty-hint {
                font-size: 0.8rem;
            }
            
            /* ÂõæÁâáÊü•ÁúãÂô®ÁßªÂä®Á´ØÈÄÇÈÖç */
            .photo-nav-btn {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }
            
            .photo-prev {
                left: 10px;
            }
            
            .photo-next {
                right: 10px;
            }
            
            .photo-close-btn {
                top: 10px;
                right: 10px;
            }
        }
        
        /* Ê®™Â±èÊ®°Âºè‰ºòÂåñ */
        @media (max-height: 500px) and (orientation: landscape) {
            .top-bar {
                padding: 6px 15px;
            }
            
            .game-title h1 {
                font-size: 1rem;
            }
            
            .main-layout {
                height: calc(100vh - 50px);
                padding: 8px;
            }
            
            .case-panel {
                max-height: none;
            }
        }
        
        /* ==================== Ê®°ÊÄÅÊ°ÜÂìçÂ∫îÂºèÈÄÇÈÖç ==================== */
        @media (max-width: 900px) {
            .modal-content {
                width: 95% !important;
                max-width: 95% !important;
            }
        }
        
        @media (max-width: 768px) {
            .modal-content {
                width: 95% !important;
                max-width: 95% !important;
                border-radius: 15px;
            }
            
            .modal-header {
                padding: 12px 15px;
            }
            
            .modal-title {
                font-size: 1rem;
            }
            
            .modal-body {
                padding: 15px;
                max-height: calc(85vh - 100px);
            }
            
            /* Ê£ÄÊµãÂïÜÂ∫óÂìçÂ∫îÂºè */
            .shop-categories {
                gap: 10px;
            }
            
            /* Áü•ËØÜÂ∫ìÂìçÂ∫îÂºè */
            #knowledge-search-input {
                padding: 12px 15px !important;
                font-size: 0.9rem !important;
            }
            
            .knowledge-content {
                max-height: calc(70vh - 150px) !important;
            }
        }
        
        @media (max-width: 480px) {
            .modal-content {
                width: 98% !important;
                max-width: 98% !important;
                border-radius: 12px;
                max-height: 95vh;
            }
            
            .modal-header {
                padding: 10px 12px;
            }
            
            .modal-title {
                font-size: 0.95rem;
            }
            
            .modal-close {
                width: 32px;
                height: 32px;
                font-size: 1rem;
            }
            
            .modal-body {
                padding: 12px;
                max-height: calc(90vh - 80px);
            }
        }
        
        /* ==================== ÁªìÂ±ÄÂä®Áîª ==================== */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-15px);
            }
            60% {
                transform: translateY(-8px);
            }
        }
        
        @keyframes glow {
            0%, 100% {
                box-shadow: 0 0 5px rgba(244, 162, 97, 0.3);
            }
            50% {
                box-shadow: 0 0 20px rgba(244, 162, 97, 0.5);
            }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        /* ÊèêÁ§∫Ê®°ÊÄÅÊ°ÜÂä®Áîª */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* ÊúØËØ≠tooltipÊ†∑Âºè */
        .term-tooltip {
            position: relative;
            cursor: help;
            border-bottom: 1px dashed var(--detective-gold);
            color: var(--detective-gold);
        }
        
        .term-tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--detective-darker);
            color: var(--text-light);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.85rem;
            white-space: nowrap;
            max-width: 300px;
            white-space: normal;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            z-index: 1000;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            pointer-events: none;
        }
        
        .term-tooltip:hover::after {
            opacity: 1;
            visibility: visible;
            bottom: calc(100% + 8px);
        }
        
        /* Â∏ÆÂä©ÊåâÈíÆËÑâÂÜ≤Âä®Áîª */
        .help-btn.pulse {
            animation: help-pulse 2s infinite;
        }
        
        @keyframes help-pulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(244, 162, 97, 0.4);
            }
            50% {
                box-shadow: 0 0 0 10px rgba(244, 162, 97, 0);
            }
        }
        
        /* Âà§ÂÆöË°®ÂçïÊ†∑ÂºèÂ¢ûÂº∫ */
        .judgment-option:hover {
            border-color: rgba(255,255,255,0.4) !important;
            transform: translateY(-2px);
        }
        
        .judgment-option.selected {
            border-color: var(--detective-accent) !important;
            background: rgba(233, 69, 96, 0.2) !important;
        }
        
        .hazard-checkbox:hover {
            border-color: rgba(255,255,255,0.3) !important;
        }
        
        .standard-clause-item:hover {
            background: rgba(255,255,255,0.08) !important;
            border-color: rgba(255,255,255,0.2) !important;
        }
        
        .standard-clause-item input:checked + div {
            color: var(--detective-green);
        }
        
        /* ÊªöÂä®Êù°Ê†∑Âºè */
        #standard-clauses-container::-webkit-scrollbar {
            width: 6px;
        }
        
        #standard-clauses-container::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 3px;
        }
        
        #standard-clauses-container::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
        }
        
        #standard-clauses-container::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.3);
        }
</style>
</head>
<body>
    <!-- È°∂ÈÉ®Áä∂ÊÄÅÊ†è -->
    <div class="top-bar">
        <div class="game-title">
            <h1>üîç Âç±Â∫üÈâ¥Âà´ÂâßÊú¨ÊùÄ</h1>
            <span class="case-badge" id="case-badge">Ê°à‰ª∂ #001</span>
        </div>
        <div class="status-group">
            <div class="budget-display">
                <span class="budget-icon">üí∞</span>
                <div>
                    <div class="budget-amount" id="budget-amount">10000</div>
                    <div class="budget-label">ËôöÊãüÈ¢ÑÁÆó</div>
                </div>
            </div>
            <div class="timer-display">
                <span>‚è±Ô∏è</span>
                <span class="timer-value" id="timer-value">00:00</span>
            </div>
            <button class="help-btn" id="help-btn" title="Â∏ÆÂä©">‚ùì</button>
        </div>
    </div>

    <!-- ‰∏ªÊ∏∏ÊàèÂå∫Âüü -->
    <div class="main-layout">
        <!-- Â∑¶‰æßÔºöÊ°à‰ª∂Âç∑ÂÆóÂå∫ -->
        <div class="case-panel">
            <div class="panel-header">
                <span class="panel-icon">üìÅ</span>
                <span>Ê°à‰ª∂Âç∑ÂÆó</span>
            </div>
            <div class="case-file" id="case-file">
                <div class="file-folder">
                    <div class="folder-tab">Êú∫ÂØÜÊ°£Ê°à</div>
                    <div class="folder-content">
                        <!-- Ê°à‰ª∂ÂêçÁß∞ - Requirements: 1.2 -->
                        <div class="case-header" id="case-header">
                            <div class="case-name" id="case-name">Ê°à‰ª∂Âä†ËΩΩ‰∏≠...</div>
                            <div class="case-description" id="case-description"></div>
                        </div>
                        <div class="case-section">
                            <div class="section-title">üè≠ Â∫üÁâ©Êù•Ê∫ê</div>
                            <div class="section-content" id="waste-source">Á≠âÂæÖÂä†ËΩΩÊ°à‰ª∂...</div>
                        </div>
                        <div class="case-section">
                            <div class="section-title">üëÅÔ∏è Â§ñËßÇÊèèËø∞</div>
                            <div class="section-content" id="waste-appearance">-</div>
                        </div>
                        <div class="case-section">
                            <div class="section-title">üëÉ Ê∞îÂë≥ÊèèËø∞</div>
                            <div class="section-content" id="waste-odor">-</div>
                        </div>
                        <div class="case-section">
                            <div class="section-title">üìä ÂàùÊ≠•Êï∞ÊçÆ</div>
                            <div class="section-content" id="preliminary-data">-</div>
                        </div>
                        <!-- ÂÖ∂‰ªñ‰ø°ÊÅØ - Requirements: 1.2 -->
                        <div class="case-section additional-info-section" id="additional-info-section" style="display:none;">
                            <div class="section-title">üìù ÂÖ∂‰ªñ‰ø°ÊÅØ</div>
                            <div class="section-content" id="additional-info">-</div>
                        </div>
                        <!-- Áé∞Âú∫ÁÖßÁâá - Requirements: 1.4 -->
                        <div class="case-section photo-section" id="photo-section" style="display:none;">
                            <div class="section-title">üì∑ Áé∞Âú∫ÁÖßÁâá <span class="photo-count" id="photo-count"></span></div>
                            <div class="photo-gallery" id="photo-gallery"></div>
                        </div>
                    </div>
                </div>
                <!-- ÈöæÂ∫¶ÂæΩÁ´† -->
                <div class="difficulty-badge" id="difficulty-badge">
                    <span class="diff-icon">‚≠ê</span>
                    <span class="diff-text">ÂàùÁ∫ß</span>
                </div>
                <!-- È¢ÑÁÆóÂæΩÁ´† - Requirements: 1.5 -->
                <div class="budget-badge" id="budget-badge">
                    <span class="budget-badge-icon">üí∞</span>
                    <span class="budget-badge-text" id="case-budget-text">10000</span>
                </div>
            </div>
        </div>

        <!-- ‰∏≠Èó¥ÔºöÁ∫øÁ¥¢Êî∂ÈõÜÂå∫ -->
        <div class="clues-panel">
            <div class="panel-header">
                <span class="panel-icon">üîé</span>
                <span>Â∑≤Êî∂ÈõÜÁ∫øÁ¥¢</span>
                <span class="clue-count" id="clue-count">0</span>
            </div>
            <div class="clues-container" id="clues-container">
                <div class="empty-clues">
                    <div class="empty-icon">üïµÔ∏è</div>
                    <div class="empty-text">Â∞öÊú™Êî∂ÈõÜ‰ªª‰ΩïÁ∫øÁ¥¢</div>
                    <div class="empty-hint">ÂâçÂæÄÊ£ÄÊµãÂïÜÂ∫óË¥≠‰π∞Ê£ÄÊµãÈ°πÁõÆ</div>
                </div>
            </div>
            
            <!-- Âà§ÂÆöÊèê‰∫§Âå∫ -->
            <div class="judgment-area">
                <button class="judgment-btn" id="submit-judgment-btn" onclick="openJudgmentModal()">
                    <span class="btn-icon">‚öñÔ∏è</span>
                    <span>Êèê‰∫§Èâ¥Âà´ÁªìËÆ∫</span>
                </button>
            </div>
        </div>

        <!-- Âè≥‰æßÔºöÂ∑•ÂÖ∑Ê†è -->
        <div class="tools-panel">
            <button class="tool-btn primary" onclick="openDetectionShop()">
                <span class="tool-icon">üõí</span>
                <span class="tool-label">Ê£ÄÊµãÂïÜÂ∫ó</span>
            </button>
            <button class="tool-btn" onclick="openKnowledgeBase()">
                <span class="tool-icon">üìö</span>
                <span class="tool-label">Áü•ËØÜÂ∫ì</span>
            </button>
            <button class="tool-btn" onclick="requestHint()">
                <span class="tool-icon">üí°</span>
                <span class="tool-label">Ê±ÇÂä©ÊèêÁ§∫</span>
                <span class="tool-cost">-500</span>
            </button>
            <button class="tool-btn" onclick="openCaseList()">
                <span class="tool-icon">üìã</span>
                <span class="tool-label">Ê°à‰ª∂ÂàóË°®</span>
            </button>
            <button class="tool-btn" onclick="openHistory()">
                <span class="tool-icon">üìú</span>
                <span class="tool-label">ÂéÜÂè≤ËÆ∞ÂΩï</span>
            </button>
            <button class="tool-btn" onclick="openCompetitionPanel()" style="border-color: rgba(244, 162, 97, 0.3);">
                <span class="tool-icon">üèÜ</span>
                <span class="tool-label">Á´ûËµõÊ®°Âºè</span>
            </button>
            <div class="tool-divider"></div>
            <button class="tool-btn back" onclick="goBack()">
                <span class="tool-icon">üö™</span>
                <span class="tool-label">ËøîÂõû</span>
            </button>
        </div>
    </div>

    <!-- Ê£ÄÊµãÂïÜÂ∫óÊ®°ÊÄÅÊ°Ü -->
    <div class="modal-overlay" id="shop-modal">
        <div class="modal-content" style="width: 800px;">
            <div class="modal-header">
                <div class="modal-title">üõí Ê£ÄÊµãÂïÜÂ∫ó</div>
                <button class="modal-close" onclick="closeModal('shop-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="shop-categories" id="shop-categories">
                    <!-- Ê£ÄÊµãÈ°πÁõÆÂàÜÁ±ªÂ∞ÜÁî±JSÂä®ÊÄÅÁîüÊàê -->
                </div>
            </div>
        </div>
    </div>

    <!-- Áü•ËØÜÂ∫ìÊ®°ÊÄÅÊ°Ü -->
    <div class="modal-overlay" id="knowledge-modal">
        <div class="modal-content" style="width: 900px;">
            <div class="modal-header">
                <div class="modal-title">üìö GB 5085 Áü•ËØÜÂ∫ì</div>
                <button class="modal-close" onclick="closeModal('knowledge-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="knowledge-search" style="margin-bottom: 20px;">
                    <input type="text" id="knowledge-search-input" placeholder="üîç ÊêúÁ¥¢Ê†áÂáÜÊù°Ê¨æÔºàÂ¶ÇÔºöpH„ÄÅÈáçÈáëÂ±û„ÄÅÈó™ÁÇπ„ÄÅÊµ∏Âá∫ÊØíÊÄß...Ôºâ" style="
                        width: 100%;
                        padding: 14px 18px;
                        border: 2px solid rgba(255,255,255,0.15);
                        border-radius: 12px;
                        background: rgba(255,255,255,0.05);
                        color: var(--text-light);
                        font-size: 1rem;
                        transition: all 0.2s;
                    " onfocus="this.style.borderColor='var(--detective-gold)'; this.style.background='rgba(255,255,255,0.08)'" onblur="this.style.borderColor='rgba(255,255,255,0.15)'; this.style.background='rgba(255,255,255,0.05)'" />
                </div>
                <div class="knowledge-content" id="knowledge-content" style="max-height: calc(80vh - 180px); overflow-y: auto;">
                    <!-- Áü•ËØÜÂ∫ìÂÜÖÂÆπÂ∞ÜÁî±JSÂä®ÊÄÅÁîüÊàê -->
                </div>
            </div>
        </div>
    </div>

    <!-- Âà§ÂÆöÊèê‰∫§Ê®°ÊÄÅÊ°Ü -->
    <div class="modal-overlay" id="judgment-modal">
        <div class="modal-content" style="width: 600px;">
            <div class="modal-header">
                <div class="modal-title">‚öñÔ∏è Êèê‰∫§Èâ¥Âà´ÁªìËÆ∫</div>
                <button class="modal-close" onclick="closeModal('judgment-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="judgment-form" id="judgment-form">
                    <!-- Âà§ÂÆöË°®ÂçïÂ∞ÜÁî±JSÂä®ÊÄÅÁîüÊàê -->
                </div>
            </div>
        </div>
    </div>

    <!-- ÁªìÂ±ÄÂ±ïÁ§∫Ê®°ÊÄÅÊ°Ü -->
    <div class="modal-overlay" id="result-modal">
        <div class="modal-content" style="width: 700px;">
            <div class="modal-header">
                <div class="modal-title" id="result-title">üéâ Ê°à‰ª∂ÁªìÊûú</div>
                <button class="modal-close" onclick="closeModal('result-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="result-content" id="result-content">
                    <!-- ÁªìÊûúÂÜÖÂÆπÂ∞ÜÁî±JSÂä®ÊÄÅÁîüÊàê -->
                </div>
            </div>
        </div>
    </div>

    <!-- Ê°à‰ª∂ÂàóË°®Ê®°ÊÄÅÊ°Ü -->
    <div class="modal-overlay" id="caselist-modal">
        <div class="modal-content" style="width: 800px;">
            <div class="modal-header">
                <div class="modal-title">üìã Ê°à‰ª∂ÂàóË°®</div>
                <button class="modal-close" onclick="closeModal('caselist-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="case-list" id="case-list">
                    <!-- Ê°à‰ª∂ÂàóË°®Â∞ÜÁî±JSÂä®ÊÄÅÁîüÊàê -->
                </div>
            </div>
        </div>
    </div>

    <!-- ÂéÜÂè≤ËÆ∞ÂΩïÊ®°ÊÄÅÊ°Ü -->
    <div class="modal-overlay" id="history-modal">
        <div class="modal-content" style="width: 800px;">
            <div class="modal-header">
                <div class="modal-title">üìú ÂéÜÂè≤ËÆ∞ÂΩï</div>
                <button class="modal-close" onclick="closeModal('history-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="history-list" id="history-list">
                    <!-- ÂéÜÂè≤ËÆ∞ÂΩïÂ∞ÜÁî±JSÂä®ÊÄÅÁîüÊàê -->
                </div>
            </div>
        </div>
    </div>

    <!-- ÂõæÁâáÊü•ÁúãÊ®°ÊÄÅÊ°Ü - Requirements: 1.4 -->
    <div class="modal-overlay" id="photo-modal" onclick="closePhotoModal(event)">
        <div class="photo-viewer-container">
            <button class="photo-nav-btn photo-prev" onclick="event.stopPropagation(); navigatePhoto(-1)">‚ùÆ</button>
            <img id="photo-viewer" src="" alt="Â∫üÁâ©ÁÖßÁâá" />
            <button class="photo-nav-btn photo-next" onclick="event.stopPropagation(); navigatePhoto(1)">‚ùØ</button>
            <div class="photo-indicator" id="photo-indicator"></div>
            <button class="photo-close-btn" onclick="closeModal('photo-modal')">√ó</button>
        </div>
    </div>

    <!-- Ê°à‰ª∂ÁºñËæëÂô®Ê®°ÊÄÅÊ°Ü -->
    <div class="modal-overlay" id="case-editor-modal">
        <div class="modal-content" style="width: 900px; max-height: 90vh;">
            <div class="modal-header">
                <div class="modal-title" id="case-editor-title">‚úèÔ∏è ÂàõÂª∫Êñ∞Ê°à‰ª∂</div>
                <button class="modal-close" onclick="closeModal('case-editor-modal')">√ó</button>
            </div>
            <div class="modal-body" style="max-height: calc(90vh - 80px); overflow-y: auto;">
                <div class="case-editor-form" id="case-editor-form">
                    <!-- Ê°à‰ª∂ÁºñËæëË°®ÂçïÂ∞ÜÁî±JSÂä®ÊÄÅÁîüÊàê -->
                </div>
            </div>
        </div>
    </div>

    <!-- Á´ûËµõÊéßÂà∂Ê®°ÊÄÅÊ°Ü - Requirements: 8.1, 8.2 -->
    <div class="modal-overlay" id="competition-modal">
        <div class="modal-content" style="width: 700px;">
            <div class="modal-header">
                <div class="modal-title">üèÜ Á´ûËµõÊ®°Âºè</div>
                <button class="modal-close" onclick="closeModal('competition-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <div id="competition-content">
                    <!-- Á´ûËµõÂÜÖÂÆπÂ∞ÜÁî±JSÂä®ÊÄÅÁîüÊàê -->
                </div>
            </div>
        </div>
    </div>

    <!-- Á´ûËµõÊéíË°åÊ¶úÊ®°ÊÄÅÊ°Ü - Requirements: 8.3 -->
    <div class="modal-overlay" id="leaderboard-modal">
        <div class="modal-content" style="width: 800px;">
            <div class="modal-header">
                <div class="modal-title">üìä ÂÆûÊó∂ÊéíË°åÊ¶ú</div>
                <button class="modal-close" onclick="closeModal('leaderboard-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <div id="leaderboard-content">
                    <!-- ÊéíË°åÊ¶úÂÜÖÂÆπÂ∞ÜÁî±JSÂä®ÊÄÅÁîüÊàê -->
                </div>
            </div>
        </div>
    </div>

    <!-- Á´ûËµõÁªìÊûúÊ®°ÊÄÅÊ°Ü - Requirements: 8.4, 8.5 -->
    <div class="modal-overlay" id="competition-result-modal">
        <div class="modal-content" style="width: 900px;">
            <div class="modal-header">
                <div class="modal-title">üèÅ Á´ûËµõÁªìÊûú</div>
                <button class="modal-close" onclick="closeModal('competition-result-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <div id="competition-result-content">
                    <!-- Á´ûËµõÁªìÊûúÂÜÖÂÆπÂ∞ÜÁî±JSÂä®ÊÄÅÁîüÊàê -->
                </div>
            </div>
        </div>
    </div>

    <!-- Ê∏∏ÊàèËßÑÂàôÊèêÁ§∫Ê®°ÊÄÅÊ°Ü -->
    <div class="modal-overlay" id="rules-modal">
        <div class="modal-content" style="width: 600px;">
            <div class="modal-header">
                <div class="modal-title">üïµÔ∏è ÁéØÂ¢É‰æ¶Êé¢ÊåáÂçó</div>
                <button class="modal-close" onclick="closeModal('rules-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="rules-content">
                    <h3 style="color: var(--detective-gold); margin-bottom: 15px;">Ê¨¢ËøéÊù•Âà∞Âç±Â∫üÈâ¥Âà´ÂâßÊú¨ÊùÄÔºÅ</h3>
                    <p style="margin-bottom: 20px; line-height: 1.8;">
                        ‰Ω†Â∞ÜÊâÆÊºî‰∏ÄÂêçÁéØÂ¢É‰æ¶Êé¢ÔºåÈÄöËøáÂàÜÊûêÊ°à‰ª∂Âç∑ÂÆó„ÄÅË¥≠‰π∞Ê£ÄÊµãÈ°πÁõÆ„ÄÅÊî∂ÈõÜÁ∫øÁ¥¢ËØÅÊçÆÔºåÊúÄÁªàÂÅöÂá∫Âç±Èô©Â∫üÁâ©Èâ¥Âà´Âà§ÂÆö„ÄÇ
                    </p>
                    <div class="rule-item" style="margin-bottom: 15px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                        <strong style="color: var(--detective-accent);">üìÅ Á¨¨‰∏ÄÊ≠•ÔºöÈòÖËØªÂç∑ÂÆó</strong>
                        <p style="margin-top: 8px; color: var(--text-muted);">‰ªîÁªÜÈòÖËØªÊ°à‰ª∂Âç∑ÂÆóÔºå‰∫ÜËß£Â∫üÁâ©ÁöÑÊù•Ê∫ê„ÄÅÂ§ñËßÇ„ÄÅÊ∞îÂë≥Á≠âÂü∫Á°Ä‰ø°ÊÅØ„ÄÇ</p>
                    </div>
                    <div class="rule-item" style="margin-bottom: 15px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                        <strong style="color: var(--detective-green);">üõí Á¨¨‰∫åÊ≠•ÔºöË¥≠‰π∞Ê£ÄÊµã</strong>
                        <p style="margin-top: 8px; color: var(--text-muted);">Ê†πÊçÆÂàÜÊûêÔºåÊúâÁ≠ñÁï•Âú∞Ë¥≠‰π∞Ê£ÄÊµãÈ°πÁõÆ„ÄÇÊ≥®ÊÑèÈ¢ÑÁÆóÊúâÈôêÔºåÈÄâÊã©ÊúÄÂÖ≥ÈîÆÁöÑÊ£ÄÊµãÔºÅ</p>
                    </div>
                    <div class="rule-item" style="margin-bottom: 15px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                        <strong style="color: var(--detective-blue);">üîé Á¨¨‰∏âÊ≠•ÔºöÂàÜÊûêÁ∫øÁ¥¢</strong>
                        <p style="margin-top: 8px; color: var(--text-muted);">Êü•ÁúãÊ£ÄÊµãÁªìÊûúÔºåÂØπÊØîGB 5085Ê†áÂáÜÈôêÂÄºÔºåÂà§Êñ≠ÊòØÂê¶Ë∂ÖÊ†á„ÄÇ</p>
                    </div>
                    <div class="rule-item" style="margin-bottom: 15px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                        <strong style="color: var(--detective-gold);">‚öñÔ∏è Á¨¨ÂõõÊ≠•ÔºöÊèê‰∫§Âà§ÂÆö</strong>
                        <p style="margin-top: 8px; color: var(--text-muted);">Ê†πÊçÆÊî∂ÈõÜÁöÑËØÅÊçÆÔºåÂÅöÂá∫ÊúÄÁªàÈâ¥Âà´Âà§ÂÆöÔºåÈÄâÊã©Âç±Èô©ÁâπÊÄßÂíå‰æùÊçÆÁöÑÂõΩÊ†áÊù°Ê¨æ„ÄÇ</p>
                    </div>
                    <button onclick="closeModal('rules-modal')" style="width: 100%; padding: 15px; border: none; border-radius: 10px; background: var(--detective-accent); color: white; font-size: 1rem; font-weight: bold; cursor: pointer; margin-top: 10px;">
                        ÂºÄÂßãÁ†¥Ê°àÔºÅ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ÂºïÂÖ•ÂÖ¨ÂÖ±Ê®°ÂùóÂíåËôöÊãüÂ∑•‰ΩçÊúçÂä° -->
    <script src="js/common.js"></script>
    <script src="js/virtual-station.js"></script>
    <!-- ÂºïÂÖ•‰∏ªÊéßÂà∂Âô® -->
    <script src="js/hazwaste-detective.js"></script>
    <script>
        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñÊ∏∏Êàè
        document.addEventListener('DOMContentLoaded', async function() {
            // ÂàùÂßãÂåñËôöÊãüÂ∑•‰ΩçÂπ≥Âè∞ÔºàÁî®‰∫éÁªèÈ™åÂÄºÁ≥ªÁªüÔºâ
            if (typeof VirtualStation !== 'undefined') {
                try {
                    await VirtualStation.init();
                    console.log('‚úÖ VirtualStation ÂàùÂßãÂåñÂÆåÊàê');
                } catch (e) {
                    console.warn('VirtualStation ÂàùÂßãÂåñÂ§±Ë¥•:', e);
                }
            }
            
            if (typeof HazwasteDetective !== 'undefined') {
                window.game = new HazwasteDetective();
                window.game.init();
            }
        });
        
        // Ê®°ÊÄÅÊ°ÜÊéßÂà∂ÂáΩÊï∞
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        // Â∑•ÂÖ∑Ê†èÊåâÈíÆÂáΩÊï∞
        function openDetectionShop() {
            if (window.game) window.game.openShop();
            openModal('shop-modal');
        }
        
        function openKnowledgeBase() {
            if (window.game) window.game.openKnowledgeBase();
            openModal('knowledge-modal');
        }
        
        function requestHint() {
            if (window.game) window.game.requestHint();
        }
        
        function openCaseList() {
            if (window.game) window.game.renderCaseList();
            openModal('caselist-modal');
        }
        
        function openHistory() {
            if (window.game) window.game.renderHistory();
            openModal('history-modal');
        }
        
        function openJudgmentModal() {
            if (window.game) window.game.openJudgmentForm();
            openModal('judgment-modal');
        }
        
        function goBack() {
            if (window.game && window.game.hasUnsavedProgress()) {
                if (confirm('ÂΩìÂâçÊ∏∏ÊàèËøõÂ∫¶Â∞ÜË¢´‰øùÂ≠òÔºåÁ°ÆÂÆöË¶ÅËøîÂõûÂêóÔºü')) {
                    window.game.saveProgress();
                    window.location.href = 'virtual-station.html';
                }
            } else {
                window.location.href = 'virtual-station.html';
            }
        }
        
        // ESCÈîÆÂÖ≥Èó≠Ê®°ÊÄÅÊ°ÜÔºåÊñπÂêëÈîÆÂØºËà™ÁÖßÁâá
        document.addEventListener('keydown', function(e) {
            // ÁÖßÁâáÂØºËà™ - Requirements: 1.4
            const photoModal = document.getElementById('photo-modal');
            if (photoModal && photoModal.classList.contains('active')) {
                if (e.key === 'ArrowLeft') {
                    navigatePhoto(-1);
                    e.preventDefault();
                } else if (e.key === 'ArrowRight') {
                    navigatePhoto(1);
                    e.preventDefault();
                }
            }
            
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay.active').forEach(modal => {
                    modal.classList.remove('active');
                });
                // ‰πüÂÖ≥Èó≠ÊèêÁ§∫Ê®°ÊÄÅÊ°Ü
                const hintModal = document.getElementById('hint-modal-overlay');
                if (hintModal) hintModal.remove();
            }
        });
        
        // Â∏ÆÂä©ÊåâÈíÆÁÇπÂáªÊòæÁ§∫ËßÑÂàô
        document.getElementById('help-btn').addEventListener('click', function() {
            openModal('rules-modal');
        });
        
        // ==================== Á´ûËµõÊ®°ÂºèÂáΩÊï∞ ====================
        // Requirements: 8.1, 8.2, 8.3, 8.4, 8.5
        
        /**
         * ÊâìÂºÄÁ´ûËµõÊéßÂà∂Èù¢Êùø
         * Requirements: 8.1 - ÊïôÂ∏àÂºÄÂêØÁ´ûËµõÔºåÈÄâÊã©Ê°à‰ª∂ÂíåÊó∂Èó¥ÈôêÂà∂
         */
        function openCompetitionPanel() {
            const container = document.getElementById('competition-content');
            if (!container || !window.game) return;
            
            const currentComp = competitionManager.getCurrentCompetition();
            
            if (currentComp && currentComp.status === 'active') {
                // ÊòæÁ§∫ËøõË°å‰∏≠ÁöÑÁ´ûËµõ
                renderActiveCompetition(container, currentComp);
            } else {
                // ÊòæÁ§∫ÂàõÂª∫Á´ûËµõË°®Âçï
                renderCompetitionForm(container);
            }
            
            openModal('competition-modal');
        }
        
        /**
         * Ê∏≤ÊüìÁ´ûËµõÂàõÂª∫Ë°®Âçï
         * Requirements: 8.1 - ÊïôÂ∏àÂºÄÂêØÁ´ûËµõÔºåÈÄâÊã©Ê°à‰ª∂ÂíåÊó∂Èó¥ÈôêÂà∂
         */
        function renderCompetitionForm(container) {
            const cases = window.game.getCaseList();
            
            container.innerHTML = `
                <div style="text-align: center; margin-bottom: 25px;">
                    <div style="font-size: 4rem; margin-bottom: 15px;">üèÜ</div>
                    <h3 style="color: var(--detective-gold); margin-bottom: 10px;">ÂàõÂª∫Á´ûËµõ</h3>
                    <p style="color: var(--text-muted);">ÈÄâÊã©Ê°à‰ª∂ÂíåÊó∂Èó¥ÈôêÂà∂ÔºåÂºÄÂêØÂ§ö‰∫∫Á´ûËµõÊ®°Âºè</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold;">ÈÄâÊã©Ê°à‰ª∂</label>
                    <select id="competition-case-select" style="
                        width: 100%;
                        padding: 12px 15px;
                        border: 2px solid rgba(255,255,255,0.15);
                        border-radius: 10px;
                        background: rgba(255,255,255,0.05);
                        color: var(--text-light);
                        font-size: 1rem;
                    ">
                        ${cases.map(c => `
                            <option value="${c.id}">${c.name} (${getDifficultyName(c.difficulty)})</option>
                        `).join('')}
                    </select>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold;">Êó∂Èó¥ÈôêÂà∂</label>
                    <div style="display: flex; gap: 10px;">
                        <button class="time-option" data-time="300" onclick="selectTimeLimit(300)" style="flex: 1; padding: 12px; border: 2px solid rgba(255,255,255,0.15); border-radius: 10px; background: transparent; color: white; cursor: pointer;">5ÂàÜÈíü</button>
                        <button class="time-option selected" data-time="600" onclick="selectTimeLimit(600)" style="flex: 1; padding: 12px; border: 2px solid var(--detective-gold); border-radius: 10px; background: rgba(244, 162, 97, 0.2); color: white; cursor: pointer;">10ÂàÜÈíü</button>
                        <button class="time-option" data-time="900" onclick="selectTimeLimit(900)" style="flex: 1; padding: 12px; border: 2px solid rgba(255,255,255,0.15); border-radius: 10px; background: transparent; color: white; cursor: pointer;">15ÂàÜÈíü</button>
                        <button class="time-option" data-time="1200" onclick="selectTimeLimit(1200)" style="flex: 1; padding: 12px; border: 2px solid rgba(255,255,255,0.15); border-radius: 10px; background: transparent; color: white; cursor: pointer;">20ÂàÜÈíü</button>
                    </div>
                </div>
                
                <div style="background: rgba(244, 162, 97, 0.1); border: 1px solid rgba(244, 162, 97, 0.3); border-radius: 12px; padding: 15px; margin-bottom: 25px;">
                    <div style="display: flex; align-items: center; gap: 10px; color: var(--detective-gold);">
                        <span>üí°</span>
                        <span style="font-weight: bold;">Á´ûËµõËØ¥Êòé</span>
                    </div>
                    <ul style="margin: 10px 0 0 25px; color: var(--text-muted); font-size: 0.9rem; line-height: 1.8;">
                        <li>ÂºÄÂêØÁ´ûËµõÂêéÔºåÊâÄÊúâÂ≠¶ÁîüÂ∞ÜÊî∂Âà∞Âêå‰∏ÄÊ°à‰ª∂</li>
                        <li>Â≠¶ÁîüÈúÄÂú®ËßÑÂÆöÊó∂Èó¥ÂÜÖÂÆåÊàêÈâ¥Âà´Âπ∂Êèê‰∫§</li>
                        <li>ÊéíË°åÊ¶úÊåâÂæóÂàÜÈôçÂ∫è„ÄÅÁî®Êó∂ÂçáÂ∫èÊéíÂàó</li>
                        <li>Á´ûËµõÁªìÊùüÂêéÂèØÂØºÂá∫ExcelÊä•Âëä</li>
                    </ul>
                </div>
                
                <button onclick="startCompetition()" style="
                    width: 100%;
                    padding: 16px;
                    border: none;
                    border-radius: 12px;
                    background: linear-gradient(135deg, var(--detective-green) 0%, #238b7e 100%);
                    color: white;
                    font-size: 1.1rem;
                    font-weight: bold;
                    cursor: pointer;
                    transition: all 0.2s;
                " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    üöÄ ÂºÄÂêØÁ´ûËµõ
                </button>
            `;
        }
        
        /**
         * Ê∏≤ÊüìËøõË°å‰∏≠ÁöÑÁ´ûËµõ
         * Requirements: 8.2 - ÊòæÁ§∫ÂÄíËÆ°Êó∂ÂíåÂÆûÊó∂ÊéíË°åÊ¶ú
         */
        function renderActiveCompetition(container, competition) {
            const remaining = competitionManager.getRemainingTime();
            const minutes = Math.floor(remaining / 60);
            const seconds = remaining % 60;
            
            container.innerHTML = `
                <div style="text-align: center; margin-bottom: 25px;">
                    <div style="font-size: 4rem; margin-bottom: 15px;">‚è±Ô∏è</div>
                    <h3 style="color: var(--detective-accent); margin-bottom: 10px;">Á´ûËµõËøõË°å‰∏≠</h3>
                    <p style="color: var(--text-muted);">${competition.caseName}</p>
                </div>
                
                <div style="text-align: center; margin-bottom: 25px;">
                    <div style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 8px;">Ââ©‰ΩôÊó∂Èó¥</div>
                    <div id="competition-countdown" style="font-size: 3rem; font-weight: bold; color: var(--detective-gold); font-family: 'Courier New', monospace;">
                        ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 25px;">
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2rem; font-weight: bold; color: var(--detective-blue);">${competition.leaderboard.length}</div>
                        <div style="font-size: 0.85rem; color: var(--text-muted);">Â∑≤Êèê‰∫§</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2rem; font-weight: bold; color: var(--detective-green);">${competition.leaderboard.length > 0 ? competition.leaderboard[0].score : '-'}</div>
                        <div style="font-size: 0.85rem; color: var(--text-muted);">ÊúÄÈ´òÂàÜ</div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px;">
                    <button onclick="openLeaderboard()" style="
                        flex: 1;
                        padding: 14px;
                        border: 2px solid var(--detective-blue);
                        border-radius: 10px;
                        background: transparent;
                        color: var(--detective-blue);
                        font-size: 1rem;
                        font-weight: bold;
                        cursor: pointer;
                    ">üìä Êü•ÁúãÊéíË°åÊ¶ú</button>
                    <button onclick="endCompetitionConfirm()" style="
                        flex: 1;
                        padding: 14px;
                        border: none;
                        border-radius: 10px;
                        background: var(--detective-accent);
                        color: white;
                        font-size: 1rem;
                        font-weight: bold;
                        cursor: pointer;
                    ">üèÅ ÁªìÊùüÁ´ûËµõ</button>
                </div>
            `;
            
            // ÂêØÂä®ÂÄíËÆ°Êó∂Êõ¥Êñ∞
            competitionManager.startCountdown();
        }
        
        /**
         * ÈÄâÊã©Êó∂Èó¥ÈôêÂà∂
         */
        let selectedTimeLimit = 600;
        function selectTimeLimit(seconds) {
            selectedTimeLimit = seconds;
            document.querySelectorAll('.time-option').forEach(btn => {
                if (parseInt(btn.dataset.time) === seconds) {
                    btn.style.borderColor = 'var(--detective-gold)';
                    btn.style.background = 'rgba(244, 162, 97, 0.2)';
                    btn.classList.add('selected');
                } else {
                    btn.style.borderColor = 'rgba(255,255,255,0.15)';
                    btn.style.background = 'transparent';
                    btn.classList.remove('selected');
                }
            });
        }
        
        /**
         * Ëé∑ÂèñÈöæÂ∫¶ÂêçÁß∞
         */
        function getDifficultyName(difficulty) {
            const names = { beginner: 'ÂàùÁ∫ß', intermediate: '‰∏≠Á∫ß', advanced: 'È´òÁ∫ß' };
            return names[difficulty] || difficulty;
        }
        
        /**
         * ÂºÄÂêØÁ´ûËµõ
         * Requirements: 8.1 - ÊïôÂ∏àÂºÄÂêØÁ´ûËµõ
         */
        function startCompetition() {
            const caseSelect = document.getElementById('competition-case-select');
            if (!caseSelect) return;
            
            const caseId = caseSelect.value;
            const caseData = window.game.caseLibrary.find(c => c.id === caseId);
            
            if (!caseData) {
                window.game.showToast('ËØ∑ÈÄâÊã©Ê°à‰ª∂', 'warning');
                return;
            }
            
            // ÂºÄÂêØÁ´ûËµõ
            competitionManager.startCompetition(caseId, selectedTimeLimit, caseData.name);
            
            // Âä†ËΩΩÁ´ûËµõÊ°à‰ª∂
            window.game.loadCase(caseId);
            
            // Êõ¥Êñ∞UI
            const container = document.getElementById('competition-content');
            renderActiveCompetition(container, competitionManager.getCurrentCompetition());
            
            window.game.showToast('üèÜ Á´ûËµõÂ∑≤ÂºÄÂêØÔºÅ', 'success');
        }
        
        /**
         * Á°ÆËÆ§ÁªìÊùüÁ´ûËµõ
         */
        function endCompetitionConfirm() {
            if (confirm('Á°ÆÂÆöË¶ÅÁªìÊùüÂΩìÂâçÁ´ûËµõÂêóÔºü')) {
                const result = competitionManager.endCompetition();
                if (result) {
                    closeModal('competition-modal');
                    showCompetitionResult(result);
                }
            }
        }
        
        /**
         * ÊâìÂºÄÊéíË°åÊ¶ú
         * Requirements: 8.3 - ÂÆûÊó∂ÊéíË°åÊ¶ú
         */
        function openLeaderboard() {
            const container = document.getElementById('leaderboard-content');
            if (!container) return;
            
            const competition = competitionManager.getCurrentCompetition();
            const leaderboard = competitionManager.getLeaderboard();
            
            if (!competition) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-muted);">ÊöÇÊó†ËøõË°å‰∏≠ÁöÑÁ´ûËµõ</div>';
                openModal('leaderboard-modal');
                return;
            }
            
            container.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div>
                        <h3 style="margin: 0; color: var(--detective-gold);">${competition.caseName}</h3>
                        <div style="font-size: 0.85rem; color: var(--text-muted);">Â∑≤Êèê‰∫§ ${leaderboard.length} ‰∫∫</div>
                    </div>
                    <button onclick="refreshLeaderboard()" style="
                        padding: 8px 16px;
                        border: 1px solid var(--detective-blue);
                        border-radius: 8px;
                        background: transparent;
                        color: var(--detective-blue);
                        cursor: pointer;
                    ">üîÑ Âà∑Êñ∞</button>
                </div>
                
                ${leaderboard.length === 0 ? `
                    <div style="text-align: center; padding: 60px 20px; color: var(--text-muted);">
                        <div style="font-size: 4rem; margin-bottom: 15px;">üìä</div>
                        <div>ÊöÇÊó†Êèê‰∫§ËÆ∞ÂΩï</div>
                    </div>
                ` : `
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: rgba(255,255,255,0.05);">
                                    <th style="padding: 12px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1);">ÊéíÂêç</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1);">Â≠¶Áîü</th>
                                    <th style="padding: 12px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1);">ÂæóÂàÜ</th>
                                    <th style="padding: 12px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1);">Áî®Êó∂</th>
                                    <th style="padding: 12px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1);">ËØÑÁ∫ß</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${leaderboard.map((entry, index) => {
                                    const rankIcon = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : (index + 1);
                                    const gradeConfig = typeof GRADE_CONFIG !== 'undefined' ? GRADE_CONFIG[entry.grade] : null;
                                    const gradeName = gradeConfig ? gradeConfig.name : entry.grade;
                                    const gradeIcon = gradeConfig ? gradeConfig.icon : '';
                                    const minutes = Math.floor(entry.elapsedTime / 60);
                                    const seconds = entry.elapsedTime % 60;
                                    
                                    return `
                                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                                            <td style="padding: 12px; text-align: center; font-size: 1.2rem;">${rankIcon}</td>
                                            <td style="padding: 12px;">${entry.studentName}</td>
                                            <td style="padding: 12px; text-align: center; font-weight: bold; color: var(--detective-gold);">${entry.score}</td>
                                            <td style="padding: 12px; text-align: center; font-family: 'Courier New', monospace;">${minutes}:${seconds.toString().padStart(2, '0')}</td>
                                            <td style="padding: 12px; text-align: center;">${gradeIcon} ${gradeName}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                `}
            `;
            
            openModal('leaderboard-modal');
        }
        
        /**
         * Âà∑Êñ∞ÊéíË°åÊ¶ú
         */
        function refreshLeaderboard() {
            openLeaderboard();
            window.game.showToast('ÊéíË°åÊ¶úÂ∑≤Âà∑Êñ∞', 'info');
        }
        
        /**
         * ÊòæÁ§∫Á´ûËµõÁªìÊûú
         * Requirements: 8.4, 8.5 - ÊòæÁ§∫ÊúÄÁªàÊéíÂêçÂíåÂØºÂá∫ÂäüËÉΩ
         */
        function showCompetitionResult(competition) {
            const container = document.getElementById('competition-result-content');
            if (!container) return;
            
            const leaderboard = competition.leaderboard || [];
            
            container.innerHTML = `
                <div style="text-align: center; margin-bottom: 25px;">
                    <div style="font-size: 4rem; margin-bottom: 15px;">üèÅ</div>
                    <h3 style="color: var(--detective-gold); margin-bottom: 10px;">Á´ûËµõÁªìÊùü</h3>
                    <p style="color: var(--text-muted);">${competition.caseName}</p>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 25px;">
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2rem; font-weight: bold; color: var(--detective-blue);">${leaderboard.length}</div>
                        <div style="font-size: 0.85rem; color: var(--text-muted);">ÂèÇËµõ‰∫∫Êï∞</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2rem; font-weight: bold; color: var(--detective-green);">${leaderboard.length > 0 ? leaderboard[0].score : '-'}</div>
                        <div style="font-size: 0.85rem; color: var(--text-muted);">ÊúÄÈ´òÂàÜ</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2rem; font-weight: bold; color: var(--detective-gold);">${leaderboard.length > 0 ? Math.round(leaderboard.reduce((sum, e) => sum + e.score, 0) / leaderboard.length) : '-'}</div>
                        <div style="font-size: 0.85rem; color: var(--text-muted);">Âπ≥ÂùáÂàÜ</div>
                    </div>
                </div>
                
                ${leaderboard.length > 0 ? `
                    <!-- Ââç‰∏âÂêçÂ±ïÁ§∫ -->
                    <div style="display: flex; justify-content: center; gap: 20px; margin-bottom: 25px;">
                        ${leaderboard.slice(0, 3).map((entry, index) => {
                            const icons = ['ü•á', 'ü•à', 'ü•â'];
                            const colors = ['#f4a261', '#94a3b8', '#cd7f32'];
                            return `
                                <div style="text-align: center; padding: 20px; background: rgba(255,255,255,0.05); border-radius: 15px; border: 2px solid ${colors[index]}30;">
                                    <div style="font-size: 2.5rem; margin-bottom: 10px;">${icons[index]}</div>
                                    <div style="font-weight: bold; margin-bottom: 5px;">${entry.studentName}</div>
                                    <div style="font-size: 1.5rem; font-weight: bold; color: ${colors[index]};">${entry.score}ÂàÜ</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <!-- ÂÆåÊï¥ÊéíË°åÊ¶ú -->
                    <div style="max-height: 300px; overflow-y: auto; margin-bottom: 20px;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: rgba(255,255,255,0.05); position: sticky; top: 0;">
                                    <th style="padding: 10px; text-align: center;">ÊéíÂêç</th>
                                    <th style="padding: 10px; text-align: left;">Â≠¶Áîü</th>
                                    <th style="padding: 10px; text-align: center;">ÂæóÂàÜ</th>
                                    <th style="padding: 10px; text-align: center;">Áî®Êó∂</th>
                                    <th style="padding: 10px; text-align: left;">Ê£ÄÊµãË∑ØÂæÑ</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${leaderboard.map((entry, index) => {
                                    const minutes = Math.floor(entry.elapsedTime / 60);
                                    const seconds = entry.elapsedTime % 60;
                                    const pathStr = entry.detectionPath ? entry.detectionPath.slice(0, 3).join(' ‚Üí ') + (entry.detectionPath.length > 3 ? '...' : '') : '-';
                                    return `
                                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                                            <td style="padding: 10px; text-align: center;">${index + 1}</td>
                                            <td style="padding: 10px;">${entry.studentName}</td>
                                            <td style="padding: 10px; text-align: center; font-weight: bold;">${entry.score}</td>
                                            <td style="padding: 10px; text-align: center;">${minutes}:${seconds.toString().padStart(2, '0')}</td>
                                            <td style="padding: 10px; font-size: 0.85rem; color: var(--text-muted);">${pathStr}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                ` : `
                    <div style="text-align: center; padding: 40px; color: var(--text-muted);">
                        <div style="font-size: 3rem; margin-bottom: 15px;">üìä</div>
                        <div>Êú¨Ê¨°Á´ûËµõÊó†‰∫∫Êèê‰∫§</div>
                    </div>
                `}
                
                <div style="display: flex; gap: 10px;">
                    <button onclick="downloadCompetitionReport()" style="
                        flex: 1;
                        padding: 14px;
                        border: 2px solid var(--detective-green);
                        border-radius: 10px;
                        background: transparent;
                        color: var(--detective-green);
                        font-size: 1rem;
                        font-weight: bold;
                        cursor: pointer;
                    ">üì• ÂØºÂá∫ExcelÊä•Âëä</button>
                    <button onclick="closeModal('competition-result-modal')" style="
                        flex: 1;
                        padding: 14px;
                        border: none;
                        border-radius: 10px;
                        background: var(--detective-blue);
                        color: white;
                        font-size: 1rem;
                        font-weight: bold;
                        cursor: pointer;
                    ">ÂÖ≥Èó≠</button>
                </div>
            `;
            
            // ‰øùÂ≠òÂΩìÂâçÁªìÊûúÁî®‰∫éÂØºÂá∫
            window._lastCompetitionResult = competition;
            
            openModal('competition-result-modal');
        }
        
        /**
         * ‰∏ãËΩΩÁ´ûËµõÊä•Âëä
         * Requirements: 8.5 - ÊîØÊåÅÂØºÂá∫Á´ûËµõÁªìÊûú‰∏∫ExcelÊä•Âëä
         */
        function downloadCompetitionReport() {
            if (window._lastCompetitionResult) {
                competitionManager.downloadExcelReport(window._lastCompetitionResult);
                window.game.showToast('Êä•ÂëäÂ∑≤‰∏ãËΩΩ', 'success');
            } else {
                window.game.showToast('Êó†Ê≥ïÂØºÂá∫Êä•Âëä', 'error');
            }
        }
        
        // ÁõëÂê¨Á´ûËµõÁªìÊùü‰∫ã‰ª∂
        window.addEventListener('competitionEnd', function(e) {
            showCompetitionResult(e.detail);
        });
    </script>
</body>
</html>
