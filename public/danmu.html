<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è¯¾å ‚å¼¹å¹•å¢™</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* å…¨å±å¸ƒå±€ï¼Œé˜²æ­¢æ»šåŠ¨ */
        body { 
            margin: 0; 
            padding: 0; 
            overflow: hidden; 
            background-color: #222; /* é»‘åº•ï¼Œé€‚åˆæŠ•å½± */
            font-family: 'Microsoft YaHei', sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* ä¸ŠåŠéƒ¨åˆ†ï¼šå¼¹å¹•æ˜¾ç¤ºåŒº (å å±å¹• 85%) */
        #screen-area {
            flex: 1;
            position: relative;
            width: 100%;
            overflow: hidden; /* å¼¹å¹•é£å‡ºå»åéšè— */
        }

        /* ä¸‹åŠéƒ¨åˆ†ï¼šè¾“å…¥æ§åˆ¶åŒº (å å±å¹• 15%) */
        #input-area {
            height: 80px;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 10px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.5);
            z-index: 100;
        }

        /* è¾“å…¥æ¡†æ ·å¼ */
        input {
            flex: 1;
            padding: 12px;
            font-size: 16px;
            border-radius: 20px;
            border: none;
            outline: none;
            margin-right: 10px;
        }

        /* å‘é€æŒ‰é’®æ ·å¼ */
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
        button:active { transform: scale(0.95); }

        /* âœˆï¸ å¼¹å¹•çš„æ ·å¼ç±» */
        .danmu-item {
            position: absolute;
            white-space: nowrap; /* ä¸æ¢è¡Œ */
            color: #fff;
            font-weight: bold;
            font-size: 28px;
            text-shadow: 2px 2px 2px rgba(0,0,0,0.8); /* æ–‡å­—é˜´å½±ï¼Œé˜²èƒŒæ™¯å¹²æ‰° */
            left: 100%; /* èµ·å§‹ä½ç½®åœ¨å±å¹•æœ€å³ä¾§å¤–é¢ */
            will-change: transform; /* æ€§èƒ½ä¼˜åŒ– */
        }

        /* æ•™å¸ˆç«¯æ¸…ç†æŒ‰é’® */
        #clear-btn {
            position: fixed;
            top: 10px;
            right: 10px;
            background: transparent;
            color: #555;
            font-size: 12px;
            border: 1px solid #555;
            padding: 5px;
            z-index: 200;
        }
    </style>
</head>
<body>

    <div id="screen-area"></div>

    <div id="input-area">
        <input type="text" id="msg-input" placeholder="è¾“å…¥ä½ æƒ³è¯´çš„è¯..." maxlength="30">
        <button onclick="sendMsg()">ğŸš€ å‘é€</button>
    </div>
    
    <button id="clear-btn" onclick="clearScreen()">æ¸…å±</button>

    <script>
        // ================= é…ç½®åŒºåŸŸ =================
        const supabaseUrl = 'hhttps://urqxrtlzaifvambytoci.supabase.co' 
        const supabaseKey = 'sb_publishable_UWJrATWMObB576H3ODCicQ_FXX5Li8h'
        // ===========================================

        const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey)
        const screen = document.getElementById('screen-area');
        const input = document.getElementById('msg-input');

        // 1. å‘é€æ¶ˆæ¯
        async function sendMsg() {
            const text = input.value.trim();
            if (!text) return;

            // æ¸…ç©ºè¾“å…¥æ¡†ï¼Œé˜²æ­¢é‡å¤ç‚¹å‡»
            input.value = '';

            // ç›´æ¥å†™å…¥æ•°æ®åº“
            const { error } = await supabaseClient
                .from('messages')
                .insert([{ content: text }])
            
            if (error) console.error('å‘é€å¤±è´¥:', error);
            
            // æœ¬åœ°ä¹Ÿç«‹åˆ»é£˜ä¸€æ¡ï¼ˆä¸ºäº†ä½“éªŒä¸æ»‘ï¼‰
            createDanmu(text, true); 
        }

        // 2. ç›‘å¬æ•°æ®åº“çš„æ–°å¼¹å¹•
        supabaseClient
            .channel('danmu-channel')
            .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages' }, payload => {
                const newMsg = payload.new.content;
                // å¦‚æœæ˜¯è‡ªå·±å‘çš„ï¼Œå‰é¢å·²ç»é£˜è¿‡äº†ï¼Œå°±ä¸ç”¨å†é£˜ä¸€æ¬¡
                // è¿™é‡Œç®€å•å¤„ç†ï¼šæ‰€æœ‰äººéƒ½é£˜ï¼ˆè‡ªå·±å¯èƒ½ä¼šçœ‹åˆ°ä¸¤æ¡ï¼Œä½†æ¼”ç¤ºæ— æ‰€è°“ï¼‰
                createDanmu(newMsg);
            })
            .subscribe()

        // 3. åˆ›å»ºå¹¶åŠ¨ç”»åŒ–å¼¹å¹• (æ ¸å¿ƒè§†è§‰é€»è¾‘)
        function createDanmu(text, isSelf = false) {
            const div = document.createElement('div');
            div.innerText = text;
            div.className = 'danmu-item';
            
            // ğŸ¨ éšæœºé¢œè‰² (è®©å¼¹å¹•äº”é¢œå…­è‰²)
            const colors = ['#FFF', '#FFE4E1', '#7FFFD4', '#FFD700', '#00BFFF', '#FF69B4'];
            div.style.color = colors[Math.floor(Math.random() * colors.length)];
            
            // å¦‚æœæ˜¯è‡ªå·±å‘çš„ï¼ŒåŠ ä¸ªè¾¹æ¡†é«˜äº®
            if (isSelf) div.style.border = "2px solid yellow";

            // ğŸ“ éšæœºé«˜åº¦ (Top: 5% ~ 80%)
            const randomTop = Math.floor(Math.random() * 80) + 5;
            div.style.top = randomTop + '%';

            // ğŸ¢ éšæœºé€Ÿåº¦ (5ç§’ ~ 10ç§’)
            const duration = Math.floor(Math.random() * 5000) + 5000;

            screen.appendChild(div);

            // ä½¿ç”¨ Web Animations API è®©å®ƒé£èµ·æ¥
            const animation = div.animate([
                { transform: 'translateX(0)' },  // èµ·ç‚¹ï¼šå±å¹•å³è¾¹ç¼˜ (CSSé‡Œè®¾ç½®äº† left: 100%)
                { transform: `translateX(-${window.innerWidth + 500}px)` } // ç»ˆç‚¹ï¼šé£åˆ°å±å¹•å·¦è¾¹å¤–
            ], {
                duration: duration,
                easing: 'linear'
            });

            // åŠ¨ç”»ç»“æŸåï¼ŒæŠŠè¿™ä¸ªå…ƒç´ ä»ç½‘é¡µé‡Œåˆ æ‰ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
            animation.onfinish = () => {
                div.remove();
            };
        }

        // 4. å›è½¦å‘é€
        input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMsg();
        });

        function clearScreen() {
            screen.innerHTML = '';
        }
    </script>
</body>
</html>