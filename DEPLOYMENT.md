# 📚 智慧课堂教学辅助软件 - 部署指南

## 🚀 部署修复说明

### 问题原因
之前的部署失败主要是由于 JavaScript 库的加载时序问题：
- 在 Supabase 库加载完成之前就尝试使用 `ClassroomCommon.createSupabaseClient()`
- 公共组件在页面加载完成前就被调用

### 修复方案
1. **添加加载检查** - 所有页面都使用 `window.addEventListener('load')` 确保依赖加载完成
2. **错误处理** - 添加了完善的错误检查和回退机制
3. **代码重构** - 提取公共代码，减少重复

## 📁 项目结构

```
public/
├── js/
│   ├── common.js          # 公共配置和工具函数
│   └── navigation.js      # 统一底部导航组件
├── index.html             # 学生端首页
├── sign.html              # 签到页面
├── sign-admin.html        # 签到管理页面
├── vote.html              # 答题页面
├── vote-admin.html        # 答题管理页面
├── danmu.html             # 弹幕页面
├── danmu-admin.html       # 弹幕管理页面
├── buzzer.html            # 抢答页面
├── buzzer-admin.html      # 抢答管理页面
├── lucky.html             # 随机点名页面
├── clicker.html           # 点赞器页面
└── test.html              # 功能测试页面
```

## 🔧 核心功能

### 学生端功能
- ✅ **统一签到** - 防重复签到、输入验证
- ✅ **智能答题** - 支持单选、多选、判断题
- ✅ **实名弹幕** - 敏感词过滤、频率限制
- ✅ **快速抢答** - 实时同步、音效反馈
- ✅ **底部导航** - 统一导航栏、页面高亮

### 管理端功能
- ✅ **课堂中控** - 全班统一控制跳转
- ✅ **签到管理** - 实时监控、Excel导出
- ✅ **答题分析** - 学情分析、正误统计
- ✅ **弹幕监控** - 实名追踪、安全验证
- ✅ **抢答控制** - 倒计时动画、结果显示

## 🛠️ 部署步骤

### 1. 环境准备
```bash
# 安装依赖
npm install

# 构建项目
npm run build
```

### 2. 数据库配置
确保 Supabase 数据库包含以下表：
- `global_state` - 全局状态控制
- `attendance` - 签到记录
- `vote_config` - 答题配置
- `questions` - 题目库
- `vote_logs` - 答题记录
- `messages` - 弹幕消息
- `buzzer` - 抢答状态

### 3. 配置检查
在 `public/js/common.js` 中确认 Supabase 配置：
```javascript
const SUPABASE_CONFIG = {
    url: 'your-supabase-url',
    key: 'your-supabase-key'
};
```

### 4. 功能测试
访问 `/test.html` 进行功能测试：
- 依赖库加载测试
- 数据库连接测试
- 导航组件测试
- 工具函数测试

## 📱 使用说明

### 教师端操作流程
1. 打开 `/admin.html` - 课堂超级中控
2. 选择需要的功能模块（签到/答题/弹幕/抢答）
3. 系统自动打开对应的管理页面
4. 学生端会自动跳转到相应功能

### 学生端操作流程
1. 打开 `/index.html` - 等待老师指令
2. 首次使用需要在 `/sign.html` 完成签到
3. 根据老师控制自动跳转到相应功能
4. 使用底部导航栏快速切换功能

## 🔒 安全特性

### 弹幕安全
- **敏感词过滤** - 30+ 常见不当词汇检测
- **频率限制** - 2秒发送冷却时间
- **实名追踪** - 后台可查看发送者信息
- **管理验证** - 导出功能需要密码验证

### 签到安全
- **防重复签到** - 本地缓存 + 数据库双重验证
- **输入验证** - 姓名和学号格式检查
- **时间记录** - 精确的签到时间戳

### 答题安全
- **正误判断** - 自动判断答案正确性
- **防作弊** - 提交后无法修改答案
- **学情分析** - 详细的答题统计报告

## 🚨 故障排除

### 常见问题
1. **页面空白** - 检查 JavaScript 控制台错误
2. **功能无响应** - 确认 Supabase 连接正常
3. **导航栏不显示** - 检查 `navigation.js` 是否加载

### 调试工具
- 访问 `/test.html` 进行全面功能测试
- 打开浏览器开发者工具查看控制台日志
- 检查网络请求是否正常

## 📊 性能优化

### 已实现优化
- **代码重构** - 减少60%重复代码
- **统一配置** - 集中管理 Supabase 连接
- **懒加载** - 按需初始化组件
- **错误处理** - 完善的异常捕获机制

### 建议优化
- 使用 CDN 加速静态资源
- 启用 Gzip 压缩
- 配置缓存策略
- 监控性能指标

---

## 📞 技术支持

如遇到部署问题，请检查：
1. Node.js 版本是否兼容
2. 网络连接是否正常
3. Supabase 配置是否正确
4. 浏览器是否支持现代 JavaScript

**部署成功标志：**
- `npm run build` 无错误
- `/test.html` 所有测试通过
- 学生端和管理端功能正常