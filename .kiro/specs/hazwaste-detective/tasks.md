# Implementation Plan

## 危废鉴别剧本杀实现任务

- [x] 1. 项目结构与基础设置






  - [x] 1.1 创建危废鉴别剧本杀HTML页面框架


    - 创建 `public/classroom/hazwaste-detective.html` 文件
    - 设置页面基础结构：顶部状态栏、游戏主区域、侧边工具栏
    - 添加必要的CSS样式（沉浸式"侦探"主题风格）
    - _Requirements: 1.1, 1.3_

  - [x] 1.2 创建核心JavaScript模块


    - 创建 `public/classroom/js/hazwaste-detective.js` 主控制器
    - 定义数据模型接口（Case, DetectionItem, GameState等）
    - 初始化本地存储连接
    - _Requirements: 1.1_

- [-] 2. 案件卷宗系统实现




  - [x] 2.1 实现案件数据结构


    - 定义Case接口和CaseFile结构
    - 创建预设案件数据（电镀污泥、废矿物油、废酸液、医疗废物、废有机溶剂）
    - 设置每个案件的正确答案和最优检测路径
    - _Requirements: 1.2, 6.2_

  - [ ] 2.2 实现卷宗展示界面
    - 创建"档案袋"风格的卷宗UI组件
    - 显示废物来源、外观、气味、初步数据
    - 实现图片证据放大查看功能
    - 显示案件难度和预算额度
    - _Requirements: 1.2, 1.3, 1.4, 1.5_

  - [ ]* 2.3 编写案件卷宗属性测试
    - **Property 1: 案件卷宗完整性**
    - **Validates: Requirements 1.2**

- [x] 3. 检测商店与预算系统实现






  - [x] 3.1 实现检测项目数据


    - 定义6大类检测项目（腐蚀性、急性毒性、浸出毒性、易燃性、反应性、毒性物质含量）
    - 设置每个项目的价格、描述、关联标准
    - 创建检测项目与案件结果的映射关系
    - _Requirements: 2.1, 2.2, 3.2_

  - [x] 3.2 实现检测商店UI


    - 创建分类展示的商店界面
    - 显示项目名称、价格、简介
    - 实现项目详情弹窗（适用废物类型、相关国标）
    - _Requirements: 2.1, 2.2, 3.2_


  - [x] 3.3 实现预算管理逻辑

    - 实现预算扣除函数
    - 实现预算不足检查
    - 实现重复购买检查
    - 记录购买顺序和时间
    - _Requirements: 2.3, 2.4, 2.6, 2.7_

  - [ ]* 3.4 编写预算交易属性测试
    - **Property 2: 预算交易完整性**
    - **Property 3: 购买记录完整性**
    - **Property 4: 检测项目分类正确性**
    - **Validates: Requirements 2.2, 2.3, 2.4, 2.6, 2.7**

- [x] 4. 线索卡片系统实现






  - [x] 4.1 实现线索卡片UI


    - 创建"线索卡片"风格的结果展示组件
    - 显示检测项目名称、检测值、标准限值、是否超标
    - 实现已收集线索的列表展示
    - _Requirements: 2.5_

  - [x] 4.2 实现线索收集逻辑


    - 购买检测项目后生成线索卡片
    - 根据案件数据返回对应检测结果
    - 超标项目高亮显示
    - _Requirements: 2.3, 2.5_

- [x] 5. Checkpoint - 确保基础功能测试通过





  - Ensure all tests pass, ask the user if questions arise.

- [x] 6. 鉴别判定系统实现






  - [x] 6.1 实现判定提交界面


    - 创建判定选项UI（危险废物/一般固废/需进一步鉴别）
    - 实现危险特性选择（腐蚀性/毒性/易燃性/反应性/感染性）
    - 实现国标条款选择器
    - _Requirements: 4.1, 4.2, 4.3_

  - [x] 6.2 实现判定验证逻辑


    - 对比学生判定与正确答案
    - 验证危险特性选择是否正确
    - 验证国标依据是否合理
    - _Requirements: 4.4_

  - [x] 6.3 实现结局展示


    - 成功结局：显示庆祝动画和详细评分
    - 失败结局：显示后果说明（环境污染/刑责/资源浪费）
    - _Requirements: 4.5, 4.6_

  - [ ]* 6.4 编写判定验证属性测试
    - **Property 5: 判定验证正确性**
    - **Validates: Requirements 4.4**


- [-] 7. 评分系统实现



  - [x] 7.1 实现多维度评分计算


    - 判定准确性得分（40%）
    - 预算使用效率得分（30%）
    - 检测路径合理性得分（20%）
    - 用时得分（10%）
    - _Requirements: 5.1, 5.2_

  - [ ] 7.2 实现评级和成就系统
    - 根据总分确定评级（金牌/银牌/铜牌/实习侦探）
    - 实现"精准侦探"成就判定
    - 生成文字反馈和改进建议
    - _Requirements: 5.3, 5.5, 5.6, 5.7_

  - [ ] 7.3 实现最优路径对比
    - 显示学生路径与最优路径的对比
    - 计算多花费的预算
    - 标记不必要的检测项目
    - _Requirements: 3.5, 5.5_

  - [ ]* 7.4 编写评分系统属性测试
    - **Property 6: 评分范围约束**
    - **Property 7: 评级阈值正确性**
    - **Property 8: 精准侦探奖励**
    - **Validates: Requirements 5.1, 5.2, 5.3, 5.6, 5.7**

- [x] 8. Checkpoint - 确保核心游戏逻辑测试通过





  - Ensure all tests pass, ask the user if questions arise.

- [x] 9. 智能提示系统实现






  - [x] 9.1 实现操作提示


    - 首次进入显示游戏规则说明
    - 连续购买无关检测时显示温和提示
    - 帮助按钮消耗预算提供推理思路
    - _Requirements: 3.1, 3.4, 8.1_


  - [x] 9.2 实现术语解释

    - 专业术语悬停tooltip
    - 检测项目详情中显示适用场景
    - _Requirements: 3.2, 3.3_


- [x] 10. 知识库系统实现



  - [x] 10.1 实现GB 5085知识库数据


    - 整理GB 5085.1-5085.6标准内容
    - 按危险特性分类组织
    - 创建限值表格数据
    - _Requirements: 9.1, 9.2_


  - [x] 10.2 实现知识库界面
    - 创建知识库面板UI
    - 实现分类浏览功能
    - 实现关键词搜索功能
    - 显示限值表格和判定方法
    - _Requirements: 9.1, 9.2, 9.3, 9.5_

  - [x] 10.3 实现检测项目与标准关联



    - 检测项目详情中显示相关国标条款
    - 游戏中提供快速跳转链接
    - _Requirements: 9.4_

  - [ ]* 10.4 编写知识库属性测试
    - **Property 13: 知识库搜索正确性**
    - **Property 14: 检测项目标准关联**
    - **Validates: Requirements 9.3, 9.4**

- [ ] 11. 游戏进度与记录实现

  - [ ] 11.1 实现进度保存
    - 自动保存游戏状态到localStorage
    - 保存案件ID、预算余额、已购线索、计时
    - _Requirements: 7.1_

  - [ ] 11.2 实现进度加载
    - 检测是否有未完成的游戏
    - 提供继续/重新开始选项
    - _Requirements: 7.2_

  - [ ] 11.3 实现历史记录
    - 完成游戏后保存完整记录
    - 显示历史记录列表
    - 支持重玩历史案件
    - _Requirements: 7.3, 7.4, 7.5_

  - [ ]* 11.4 编写游戏进度属性测试
    - **Property 10: 游戏进度持久化**
    - **Property 11: 重玩状态重置**
    - **Validates: Requirements 7.1, 7.3, 7.5**

- [ ] 12. Checkpoint - 确保进度保存功能测试通过
  - Ensure all tests pass, ask the user if questions arise.

- [ ] 13. 案件管理功能实现

  - [ ] 13.1 实现案件列表界面
    - 显示所有可用案件（预设+自定义）
    - 显示案件难度、完成状态、最高分
    - _Requirements: 6.1_

  - [ ] 13.2 实现案件编辑器（教师功能）
    - 创建案件编辑表单
    - 支持设置卷宗信息、检测结果、正确答案
    - 支持设置难度、预算、时间限制
    - _Requirements: 6.3, 6.4_

  - [ ] 13.3 实现案件验证
    - 验证案件必须有正确答案
    - 验证案件必须有至少一条关键线索
    - _Requirements: 6.5_

  - [ ]* 13.4 编写案件验证属性测试
    - **Property 9: 案件验证完整性**
    - **Validates: Requirements 6.5**

- [ ] 14. 多人竞赛模式实现

  - [ ] 14.1 实现竞赛控制
    - 教师开启竞赛，选择案件和时间限制
    - 向所有在线学生推送竞赛
    - 显示倒计时
    - _Requirements: 8.1, 8.2_

  - [ ] 14.2 实现实时排行榜
    - 学生提交后实时更新排行榜
    - 按得分降序、用时升序排列
    - _Requirements: 8.3_

  - [ ] 14.3 实现竞赛结果
    - 显示最终排名
    - 显示各学生检测路径对比
    - 支持导出Excel报告
    - _Requirements: 8.4, 8.5_

  - [ ]* 14.4 编写排行榜属性测试
    - **Property 12: 排行榜排序正确性**
    - **Validates: Requirements 8.3, 8.4**

- [ ] 15. 系统集成

  - [ ] 15.1 添加导航入口
    - 在admin.html添加"危废鉴别剧本杀"入口按钮
    - 在presentation.html添加课件链接
    - _Requirements: 1.1_

  - [ ] 15.2 样式优化和响应式适配
    - 确保与现有系统风格一致
    - 适配不同屏幕尺寸
    - 优化移动端体验
    - _Requirements: 1.3_

- [ ] 16. Final Checkpoint - 确保所有测试通过
  - Ensure all tests pass, ask the user if questions arise.

